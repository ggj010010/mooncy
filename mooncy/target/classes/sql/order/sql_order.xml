<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order">

    <resultMap type="com.spring.mooncy.dto.PagingDTO" id="PagingDTO">

    	<result property="pageNo" column="numrow"/>

    	<result property="totalCnt" column="totalcnt"/>

    </resultMap>

	<resultMap type="com.spring.mooncy.dto.OrderDTO" id="OrderDTO">

		<result property="request_id" column="request_id"/>

    	<result property="o_no" column="o_no"/>

    	<result property="m_id" column="m_id"/>

		<result property="m_name" column="m_name"/>
		
    	<result property="o_check" column="o_check"/>

    	<result property="p_name" column="p_name"/>

    	<result property="p_count" column="p_count"/>
    	
    	<result property="p_date" column="p_date"/>

    	<collection property="pagingDTO" resultMap="PagingDTO" />

    </resultMap>
	<resultMap type="com.spring.mooncy.dto.Order_ManagementDTO" id="Order_ManagementDTO">
		<result property="om_no" column="om_no"/>
		<result property="request_id" column="request_id"/>
    	<result property="response_id" column="response_id"/>
    	<result property="request_name" column="request_name"/>
    	<result property="response_name" column="response_name"/>
    	<result property="p_name" column="p_name"/>
    	<result property="p_count" column="p_count"/>
    	<result property="om_date" column="om_date"/>
    	<result property="m_name" column="m_name"/>
    </resultMap>
    

    

	<select id="selectOrder" parameterType="com.spring.mooncy.dto.PagingDTO" resultMap="OrderDTO">

	/*order.selectOrder*/

		SELECT  
		
		distinct  m_user.m_name
		
                ,p_order.m_id

				,o_check

				,p_name

				,p_count
				
				,p_date

		FROM p_order, m_user 
		
		where o_check = 0 and m_user.m_id = p_order.m_id
		
		order by p_date desc

	</select>
	

	<select id="selectOrderView" parameterType="com.spring.mooncy.dto.PagingDTO" resultMap="OrderDTO">

	/*order.selectOrderView*/

		SELECT *

		FROM 

		(

			select

				o_no

				,m_id

				,o_check

				,p_name

				,p_count
				
				,p_date
				
				,row_number() over(order by o_no desc) as numrow

				,count(*) over() as totalcnt

			from

				p_order

			order by p_date desc , o_check asc

		)

		where m_id = #{m_id ,jdbcType=VARCHAR} and numrow between (#{pageNo, jdbcType=NUMERIC}-1)*5 + 1 AND #{pageNo, jdbcType=NUMERIC}*5

		
	</select>
<!-- 	 <select id="selectOrder_User" parameterType="com.spring.mooncy.dto.PagingDTO" resultMap="Order_ManagementDTO">

	/*order.selectOrder_User*/
	
	
			SELECT 
				request_id as m_id 	
				,DISTINCT om_no
				,(select DISTINCT m_name from m_user m, order_management om1  where m.m_id = om.request_id and om.om_no = om1.OM_NO) as request_name 
				,(select DISTINCT m_name from m_user m, order_management om2  where m.m_id = om.response_id and om.om_no = om2.OM_NO) as response_name
				,p_name
				,p_count
				,om_date

			FROM order_management om, m_user m
				where om_date between to_date(, 'YYYYMMDD') and to_date('20031201', 'YYYYMMDD')
				order by om_date desc

	</select> -->
<!-- 
	<select id="selectRoomOne" parameterType="com.spring.moon.dto.RoomDTO" resultMap="RoomDTO">

	/*room.selectRoomOne*/

		SELECT *

		FROM room

		where room_id = #{r_id}

	</select>



	

	<insert id="insertRoom" parameterType="com.spring.moon.dto.RoomDTO">

	/*room.insertRoom*/

	<selectKey keyProperty="r_id" resultType="Integer" order="BEFORE"> 

		SELECT 

			nvl(TO_NUMBER(MAX(room_id)+1),0)

		FROM

			room 

	</selectKey>

		INSERT INTO

			room

			(

    			room_id

    			,room_name

    			,room_com

    			,room_price

    			,room_img

			)

    	VALUES

		(

    		#{r_id}

	  		,#{r_name}

    		,#{r_com, jdbcType=VARCHAR}

    		,#{r_price}

    		,#{r_img, jdbcType=VARCHAR}

    	)

    	

	</insert>

	

	<update id="updateRoom" parameterType="com.spring.moon.dto.RoomDTO">

	/*room.updateRoom*/

		UPDATE

			room

		SET

			room_name = #{r_name}

			,room_com = #{r_com }

			,room_price = #{r_price}

		WHERE

			room_id = #{r_id}

	

	</update>

	

	<delete id="deleteRoom" parameterType="com.spring.moon.dto.RoomDTO">

	/*room.deleteRoom*/

		DELETE

		FROM

			room

		WHERE

			room_id = #{r_id}

	

	</delete>

	

	<update id="fileNameUpdate" parameterType="com.spring.moon.dto.RoomDTO">

	/*room.fileNameUpdate*/

		UPDATE

			room

		SET

			room_img = #{r_img}

		WHERE

			room_id = #{r_id}

	</update> -->

</mapper>